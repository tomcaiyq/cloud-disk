<?xml version="1.0"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tomcai.cloud.dao.FileDao">
    <sql id="fileInfoColumns">
        a.id, a.file_name, a.url, a.size, b.name as type, a.type_id,
        a.uploader_id, a.suffix, a.upload_date as uploadDate, a.update_date
    </sql>

    <insert id="insert" parameterType="fileInfo">
        insert into file_info(id,file_name,url,size,type_id,suffix,uploader_id)
        values (#{id},#{fileName},#{url},#{size},#{typeId},#{suffix},#{uploaderId})
    </insert>

    <select id="find" parameterType="fileInfo" resultType="fileInfo">
        select
        <include refid="fileInfoColumns"/>
        from file_info a left join file_type b
        on a.type_id=b.id
        where a.del=#{del} and a.id=#{id} and a.uploader_id=#{uploaderId}
    </select>

    <select id="list" resultType="fileInfo">
        select
        <include refid="fileInfoColumns"/>
        from file_info a left join file_type b
        on a.type_id=b.id
        where a.del=#{del} and a.uploader_id=#{uploaderId}
        order by a.upload_date desc
    </select>

    <delete id="delete" parameterType="fileInfo">
        update file_info set del=#{del} where id=#{id}
    </delete>
</mapper>
